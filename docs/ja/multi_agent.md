---
search:
  exclude: true
---
# 複数エージェントのオーケストレーション

オーケストレーションとは、アプリ内でのエージェントのフローを指します。どのエージェントが、どの順序で実行され、次に何をするかをどのように決定するかということです。エージェントをオーケストレーションする方法は主に 2 つあります。

1. LLM に意思決定させる方法: LLM の知能を活用して計画・推論し、次に取るステップを決定します。  
2. コードでオーケストレーションする方法: コードでエージェントのフローを決定します。

これらのパターンは組み合わせて使用できます。それぞれにトレードオフがあるため、以下で説明します。

## LLM によるオーケストレーション

エージェントとは、instructions、tools、handoffs を備えた LLM です。オープンエンドなタスクが与えられたとき、LLM はタスクをどのように処理するかを自律的に計画し、tools を使ってアクションを実行・データ取得し、handoffs を使ってサブエージェントにタスクを委譲できます。たとえば、リサーチエージェントは次のような tools を備えることができます。

-   Web 検索: オンラインで情報を探す  
-   ファイル検索と取得: 社内データや接続先を検索する  
-   コンピュータ操作: コンピュータ上でアクションを実行する  
-   コード実行: データ分析を行う  
-   Handoffs: 計画立案やレポート作成などに特化したエージェントへ委譲する  

このパターンはタスクがオープンエンドで、LLM の知能に頼りたい場合に最適です。重要なポイントは次のとおりです。

1. 良いプロンプトに投資する: 利用可能な tools、その使い方、守るべきパラメーターを明確にします。  
2. アプリをモニタリングし、改善を繰り返す: 問題が起きる箇所を確認し、プロンプトを調整します。  
3. エージェントに内省と改善を許可する: 例えばループで実行して自己批評させる、またはエラーメッセージを渡して改善させます。  
4. 何でもこなす汎用エージェントより、特定タスクに特化したエージェントを用意する。  
5. [evals](https://platform.openai.com/docs/guides/evals) に投資する: エージェントを訓練し、タスク遂行能力を高められます。  

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードでオーケストレーションすると速度・コスト・性能の面でより決定論的かつ予測可能になります。代表的なパターンは以下です。

-   structured outputs を用いて適切な形式のデータを生成し、コードで検査する。例として、エージェントにタスクをいくつかの カテゴリー に分類させ、その カテゴリー に基づき次のエージェントを選択する方法があります。  
-   あるエージェントの出力を次のエージェントの入力に変換し、複数エージェントをチェーンする。ブログ記事の作成を「リサーチ → アウトライン作成 → 記事執筆 → 批評 → 改善」の一連のステップに分解するなどです。  
-   タスクを実行するエージェントを `while` ループで回し、別のエージェントが評価とフィードバックを行い、評価者が基準を満たしたと判断するまで繰り返す。  
-   Python の基本コンポーネントである `asyncio.gather` などを用いて複数エージェントを並列実行する。互いに依存しない複数タスクを高速に処理したい場合に有用です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) に多数の code examples があります。